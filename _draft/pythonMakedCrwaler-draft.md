---
layout: post
title: "[Python] 크롤링으로 업무 자동화하기"
date: 2019-11-24 10:00:00
category: python
tag: 
- python
comments: true
---

어느날 협업팀에서 API 파라미터 명세 정보가 변경되었는데, 우리팀에 내용이 전달되지 않아 문제가 발생하는 일이 있었다.  
긴급하게 수정하여 문제를 해결했지만, 사람이하는 일이기 때문에 언젠가는 또 발생할 수 있는 일이였다.  
그래서 나는 수 많은 명세서의 변경을 감지하여 알려주는 크롤러를 만들기 시작했다.


### 기대효과
협업팀에서 관리하는 API 서비스 명세서의 수는 대략 50개 가까이된다. 그리고 각 명세서 파일의 첫번째 시트에 명세서의 변경된 사항을 로그로 남긴다.

근데 이 변경된 사항이 우리팀에게도 매우 중요하다. 때로는 API 서비스에 직접적인 문제를 일으킬 수 있을 정도로 크리티컬할 수 있다. 그래서 항상 명세서 정보의 변경을 인지하고 있어야만 한다.

매일 변경을 인지하기 위해 사람이 직접 조취를 취하는 방법을 생각해보았다.

- 변경 즉시 우리팀에게 내용을 전달한다.
- 매일 특정 시간마다 파일들을 다운 받아 이전 버전과 비교한다.

방법은 참 간단하다. 하지만 이 방법은 현실적으로 문제가 있다.

- ~~변경 즉시 우리팀에게 내용을 전달한다.~~ 사람은 실수할 수 있고, 실제로 문제가 발생했다.
- ~~매일 특정 시간마다 파일들을 다운 받아 이전 버전과 비교한다.~~ 한번 할때마다 1~2시간 정도 소요될 수 있는 업무다. 오전, 오후 두번한다고 하면 그건 꽤 큰 리소스 낭비다. (그리고 누가 이걸하고 싶겠나)

회사내에서는 변경된 내용을 이메일로 전송해준다고 했으나, 별로 좋은 방법으로 여겨지진 않았다. 나는 사소한 변화도 우리가 인지하고 싶었고, 필요하다면 신속한 조치를 취하고 싶었다.

그래서 나는 개발자답게 컴퓨터에게 업무를 할당하려고 한다. '매일 오전, 오후 두번 모든 명세서를 비교해서 우리에게 변경사항을 알려줘'라고 말이다. 컴퓨터가 이 업무를 대신했을때 기대효과는 이러하다.

- 우리가 업무를 잊고있어도 컴퓨터는 문제가 발생하지 않는 이상 잊어버리지 않는다.
- 문제가 발생해도 문제가 발생했다고 알려준다.
- 사람이 1~2시간이라는 시간이 필요할때, 컴퓨터는 1분안에 해결할 수 있다.
- 어느 누구라도 하기 싫은 일을 군말없이 한다.
- 팀원 모두는 더 생산적인 일에 집중할 수 있다.

그래서 나는 명세서를 공유하고 있는 사내 드라이브 페이지를 크롤러할 프로그램을 설계하기 시작한다.

### 설계
#### 프로세스 정리
사내 드라이브 페이지는 사내계정 로그인을 통해서만 접근이 가능하다. 그리고 동적으로 렌더링되는 페이지이기 때문에 스크립트가 동작되어야 했다. 대충 화면은 이러하다.

![crawlerProcess1](/assets/images/post/crawlerProcess1.png){: width="100%"}*\<로그인 페이지\>*

![crawlerProcess2](/assets/images/post/crawlerProcess2.png){: width="100%"}*\<명세서 다운로드\>*

이렇게 간단하다. 로그인하고 다운로드하면 끝이다. 그리고 다운로드한 디렉토리는 zip파일로 다운로드되고 이를 풀어주면 아래와 같다. (대외비라 공개할 수 없다...)

![crawlerProcess3](/assets/images/post/crawlerProcess3.png){: width="100%"}*\<명세서 다운로드 결과\>*

그리고 명세서 내용은 대략 아래와 같이 구성되어 있다.

![crawlerProcess4](/assets/images/post/crawlerProcess4.png){: width="100%"}*\<명세서 내용 예시\>*

이 데이터들이 수정, 삭제, 추가된 것을 파악하면 됐다.

그리고 이 파악된 정보는 현재 팀내에서 사용중인 **슬랙**으로 전송해주면 되는 것이다.

간단하다. 정리하면 이렇다.

1. 페이지 로그인
2. 서비스 명세서 디렉토리 다운로드
3. 다운로드된 zip파일 풀기
4. 파일 비교한 결과 슬랙으로 전송
5. 다음 파일 비교를 위해 현재 버전 백업

#### 사용할 기술



### 왜 파이썬을 사용했나?

### 왜 셀레니움과 크롬 드라이버를 사용했는가?

### 셀레니움이란?

### 쎌레니움 초기화

### 페이지 로그인

### 파일 다운로드

### 왜 판다스를 사용했는가?

### 판다스 다른 데이터 존재 비교하기

### 슬랙이란?

### 슬랙 전송

### 만들고나서 효과

### 앞으로 진행할 일